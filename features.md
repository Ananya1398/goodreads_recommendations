# Features Documentation

This document describes all features generated by the Goodreads recommendation system feature engineering pipeline.

## Overview

The feature engineering pipeline creates 40+ features across three levels:
- **Book-level features**: Characteristics of books
- **User-level features**: User behavior and preferences
- **Interaction-level features**: Specific user-book interaction patterns

## Feature Table

| Feature Name | Description | Calculation Method | Data Type | Level |
|-------------|-------------|-------------------|-----------|-------|
| **user_id_clean** | Unique user identifier | Direct from interactions table | STRING | Interaction |
| **book_id** | Unique book identifier | Direct from interactions table | INTEGER | Interaction |
| **rating** | User's rating for the book | COALESCE(rating, 0) | INTEGER | Interaction |
| **is_read** | Whether user has read the book | COALESCE(is_read, FALSE) | BOOLEAN | Interaction |
| **user_days_to_read** | Days taken by user to read this book | DATE_DIFF between read_at and started_at (1-365 days range) | INTEGER | Interaction |
| **user_book_recency** | Days since user read this book | DATE_DIFF(CURRENT_DATE, read_at_date) | INTEGER | Interaction |
| **num_books_read** | Total books read by user | COUNTIF(is_read) grouped by user | INTEGER | User |
| **avg_rating_given** | Average rating given by user | AVG(rating) WHERE rating > 0 | FLOAT | User |
| **user_activity_count** | Total interactions by user | COUNT(book_id) grouped by user | INTEGER | User |
| **recent_activity_days** | Days since user's last activity | DATE_DIFF(CURRENT_DATE, MAX(date_updated)) | INTEGER | User |
| **user_avg_reading_time_days** | User's average reading speed | AVG(days_to_read) for valid reading times | FLOAT | User |
| **title_clean** | Cleaned book title | COALESCE(title_clean, '') | STRING | Book |
| **average_rating** | Book's average rating | COALESCE(average_rating, 0.0) | FLOAT | Book |
| **ratings_count** | Number of ratings for book | COALESCE(ratings_count, 0) | INTEGER | Book |
| **text_reviews_count** | Number of text reviews | COALESCE(text_reviews_count, 0) | INTEGER | Book |
| **log_ratings_count** | Log-transformed ratings count | LOG(1 + ratings_count) | FLOAT | Book |
| **popularity_score** | Combined popularity metric | ratings_count + text_reviews_count | INTEGER | Book |
| **title_length_in_characters** | Length of title in characters | LENGTH(title_clean) | INTEGER | Book |
| **title_length_in_words** | Number of words in title | ARRAY_LENGTH(SPLIT(title_clean, ' ')) | INTEGER | Book |
| **description_length** | Length of book description | LENGTH(description_clean) | INTEGER | Book |
| **num_genres** | Number of genres/shelves | ARRAY_LENGTH(popular_shelves_flat) | INTEGER | Book |
| **is_series** | Whether book is part of series | ARRAY_LENGTH(series_flat) > 0 | BOOLEAN | Book |
| **num_pages** | Number of pages in book | COALESCE(num_pages, 300) | INTEGER | Book |
| **publication_year** | Year book was published | COALESCE(publication_year, CURRENT_YEAR - 5) | INTEGER | Book |
| **book_age_years** | Years since publication | CURRENT_YEAR - publication_year | INTEGER | Book |
| **avg_book_reading_time_days** | Average days to read this book | AVG(reading_times) across all readers | FLOAT | Book |
| **num_readers_with_reading_time** | Count of readers with valid reading time data | COUNT of valid reading times | INTEGER | Book |
| **adjusted_average_rating** | Bayesian average rating | Wilson score with confidence interval | FLOAT | Book |
| **great** | Whether book is highly rated | adjusted_average_rating >= 80th percentile | BOOLEAN | Book |
| **book_popularity_normalized** | Normalized popularity (0-1) | MIN-MAX normalization of popularity_score | FLOAT | Book |
| **reading_pace_category** | Reading speed category | CASE: quick_read/moderate/long_read/very_long | STRING | Book |
| **book_length_category** | Book length category | CASE based on pages: short/medium/long/very_long | STRING | Book |
| **avg_pages_per_day** | Average reading speed for book | num_pages / avg_book_reading_time_days | FLOAT | Book |
| **book_era** | Publication era category | CASE: new_release/recent/contemporary/modern/classic | STRING | Book |
| **user_avg_rating_vs_book** | User's rating tendency vs book average | avg_rating_given - adjusted_average_rating | FLOAT | Computed |
| **user_reading_speed_ratio** | User's speed vs average for book | user_days_to_read / avg_book_reading_time_days | FLOAT | Computed |
| **user_pages_per_day_this_book** | User's reading speed for this book | num_pages / user_days_to_read | FLOAT | Computed |

## Feature Categories

### Temporal Features
- `user_book_recency`: Helps identify recently read books
- `recent_activity_days`: Indicates user engagement level
- `book_age_years`: Useful for trend analysis

### Behavioral Features
- `num_books_read`: User reading volume
- `avg_rating_given`: User rating behavior
- `user_avg_reading_time_days`: Reading speed preference

### Content Features
- `num_genres`: Book complexity/diversity
- `description_length`: Content richness indicator
- `is_series`: Series preference signal

### Popularity Features
- `ratings_count`: Raw popularity
- `popularity_score`: Combined metric
- `book_popularity_normalized`: Scaled for ML models

### Quality Features
- `average_rating`: Raw quality signal
- `adjusted_average_rating`: Bias-corrected rating
- `great`: Binary high-quality indicator

### Reading Difficulty Features
- `num_pages`: Book length
- `avg_book_reading_time_days`: Actual reading time
- `reading_pace_category`: Categorical difficulty

## Data Quality Notes

1. **Null Handling**: All features use COALESCE with sensible defaults
2. **Date Parsing**: Uses SAFE.PARSE_TIMESTAMP to handle malformed dates
3. **Range Validation**: Reading times bounded between 1-365 days
4. **Default Values**:
   - Pages: 300 (average book length)
   - Reading time: 14 days (two weeks)
   - Rating: 3.0 (neutral)
   - Recency: 365 days (one year)

## Usage in ML Models

### Numerical Features (can be used directly)
- All INTEGER and FLOAT types
- Should be normalized/standardized for neural networks

### Categorical Features (need encoding)
- `reading_pace_category`
- `book_length_category`
- `book_era`

### Binary Features (already encoded)
- `is_read`
- `is_series`
- `great`

### Text Features (need embedding)
- `title_clean` (for content-based filtering)

## Feature Engineering Pipeline Output

**Table Name**: `goodreads_features_cleaned`  
**Total Features**: 41  
**Row Count**: ~24.3M interactions  
**Storage Size**: ~7.25 GB